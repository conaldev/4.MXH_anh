<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
    <script th:src="@{/js/app.js}"></script>
</head>
<body>
<div th:replace="~{layout/layout::header(${user})}"></div>

<div class="container-fluid mt-5">
    <div class="row">
        <div class="col-md-8">
            <div id="img-content">
                <img th:src="@{'/'+${post.photoName}}"
                     th:alt="${post.title}" class="img-fluid mx-auto d-block">
            </div>
        </div>
        <div class="col-md-4">
            <div class="media border p-3">
                <a th:href="@{/uploader/__${post.appUser.id}__}" th:title="${post.appUser.username}">
                    <img th:src="@{'/'+${post.appUser.avatarFileName}}" class="mr-3 mt-3 rounded-circle"
                         style="width:60px;">
                </a>
                <div class="media-body">
                    <h4>
                        <a th:href="@{/uploader/__${post.appUser.id}__}" th:title="${post.appUser.username}"
                           th:text="${post.appUser.fullName}"></a>
                    </h4>
                    <small><i>Posted on
                        <time th:text="${post.dateUpload}">
                        </time>
                    </i>
                    </small>
                    <p th:text="${post.title}">Lorem ipsum...</p>
                </div>
            </div>
            <div class="stats">
                            <span class="likes">Lượt like: <span class="number"
                                                                 th:text="${post.likeCount}"></span></span>
                <span class="comments">Lượt bình luận: <span class="number"
                                                             th:text="${post.commentCount}"></span></span>
            </div>
            <th:block sec:authorize="isAuthenticated()">
                <div class="commentContainer" style="overflow: auto">
                    <div id="container-wrapper">
                        <form id="form-container" action="" method="post" th:object="${newComment}">
                            <div class="avatar_comment" id="input-avatar">
                                <img class="avatar_comment" th:src="@{'/'+${user.avatarFileName}}" height="40"
                                     width="40">
                            </div>
                            <fieldset>
                                    <textarea th:name="*{content}"
                                              placeholder="What's happening?" id="input-textarea"></textarea>
                                <div class="character-count"><span id="input-characters">0</span>/140 characters
                                </div>
                            </fieldset>
                            <button class="compose"
                                    th:onclick="'submitComment(\'' + ${post.id} +'\',\''+${user.id} + '\')'">
                                <img src="/data/compose-icon.png" height="20" width="20">

                            </button>
                            <input type="hidden" th:id="'fullName' + ${post.id} +${user.id}"
                                   th:value="${user.fullName}" name="fullName">
                            <input type="hidden" th:id="'userName' + ${post.id} +${user.id}"
                                   th:value="${user.username}" name="userName">
                            <input type="hidden" th:id="'avatarFile' + ${post.id} +${user.id}"
                                   th:value="'/'+${user.avatarFileName}" name="userName">
                        </form>
                    </div>
                </div>
                <article th:id="'article-container-'+${comment.id}" th:each="comment: ${commentPage}">
                    <header>
                        <th:block th:if="${user.id == comment.appUser.id}">
                            <button class="close" th:onclick="'deleteComment(\'' + ${comment.id} + '\');'">
                                <img src="/data/close.png" height="15" width="15">
                            </button>
                            <div></div>
                            <button class="edit" th:onclick="'editCommentInPost(\'' + ${comment.id} + '\');'">
                                Edit
                            </button>
                            <div></div>
                        </th:block>
                        <div class="avatar_comment">
                            <img class="avatar_comment" th:src="@{'/'+${comment.appUser.avatarFileName}}"
                                 height="40" width="40">
                        </div>
                        <h4 th:text="${comment.appUser.fullName}"></h4>
                        <i th:text="'@'+${comment.appUser.username}"></i>
                    </header>
                    <blockquote th:text="${comment.content}" th:id="'comment-content'+${comment.id}">
                    </blockquote>
                    <hr>
                    <footer>
                        <p class="date-posted">Posted
                            <time th:text="${comment.timeComment}"></time>
                        </p>
                        <button class="heart"
                                th:onclick="'loveComment(\'' + ${comment.id} +'\',\''+${user.id} + '\');'">
                            <th:block th:if="${#lists.contains(listHeartUserIds, user.id)}">
                                <img src="/data/heart-active.svg" th:id="'heart-image-'+${comment.id}" height="15"
                                     width="16">
                            </th:block>
                            <th:block th:unless="${#lists.contains(listHeartUserIds, user.id)}">
                                <img src="/data/heart.svg" th:id="'heart-image-'+${comment.id}" height="15" width="16">
                            </th:block>
                            <span
                                    class="heart" th:id="'heart' + ${comment.id}" title="heart"
                                    th:text="  ${comment.loveCount}"></span>
                        </button>
                    </footer>
                </article>
            </th:block>
            <div th:replace="~{layout/layout::footer}"></div>
        </div>
    </div>
</div>

</body>
</html>