<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
    <script th:src="@{/js/app.js}"></script>
</head>
<body>
<div th:replace="~{layout/layout::header(${user})}"></div>

<div class="container mt-5">
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">
            <div class="photoInfo">
                <h1 th:text="${post.title}">
                </h1>
                <div class="stats">
                            <span class="likes">Lượt like: <span class="number"
                                                                 th:text="${post.likeCount}"></span></span>
                    <span class="comments">Lượt bình luận: <span class="number"
                                                                 th:text="${post.commentCount}"></span></span>
                </div>
                <div class="source">
                            <span class="source">Nguồn:
                                <span class="text">Sưu tầm</span>
                            </span>
                </div>
            </div>
            <div class="uploader">
                <div>
                    <img th:src="@{'/'+${post.appUser.avatarFileName}}" style="width: 10%;height: 10%">
                    <div class="info">
                        <a href="/#" th:title="${post.appUser.fullName}"></a>
                    </div>
                    <time
                            th:name="*{post.dateUpload}"></time>
                    <time th:text="${post.dateUpload}"></time>
                </div>
            </div>
            <div data-fixedtop="40" class="fixedScrollDetector">
            </div>
            <div>
                <img th:src="@{'/'+${post.photoName}}"
                     th:alt="${post.title}" class="img-fluid">
            </div>
            <th:block sec:authorize="isAuthenticated()">
                <div class="commentContainer">
                    <h3>Bình luận
                    </h3>
                    <div id="container-wrapper">
                        <form id="form-container" action="" method="post" th:object="${newComment}">
                            <div class="avatar_comment" id="input-avatar">
                                <img th:src="@{'/'+${user.avatarFileName}}" height="40" width="40">
                            </div>
                            <fieldset>
                                    <textarea th:name="*{content}"
                                              placeholder="What's happening?" id="input-textarea"></textarea>
                                <div class="character-count"><span id="input-characters">0</span>/140 characters
                                </div>
                            </fieldset>
                            <button class="compose"
                                    th:onclick="'submitPost(\'' + ${post.id} +'\',\''+${user.id} + '\');'">
                                <img src="/data/compose-icon.png" height="20" width="20">

                            </button>
                            <input type="hidden" th:id="'fullName' + ${post.id} +${user.id}"
                                   th:value="${user.fullName}" name="fullName">
                            <input type="hidden" th:id="'userName' + ${post.id} +${user.id}"
                                   th:value="${user.username}" name="userName">
                            <input type="hidden" th:id="'avatarFile' + ${post.id} +${user.id}"
                                   th:value="'/'+${user.avatarFileName}" name="userName">
                        </form>
                    </div>
                </div>
                <article th:id="'article-container-'+${comment.id}" th:each="comment: ${commentPage}">
                    <header>
                        <th:block th:if="${user.id == comment.appUser.id}">
                            <button class="close" th:onclick="'deleteComment(\'' + ${comment.id} + '\');'">
                                <img src="/data/close.png" height="15" width="15">
                            </button>
                            <div></div>
                            <button class="edit" th:onclick="'editCommentInPost(\'' + ${comment.id} + '\');'">
                                Edit
                            </button>
                            <div></div>
                        </th:block>
                        <div class="avatar_comment">
                            <img class="avatar_comment" th:src="@{'/'+${comment.appUser.avatarFileName}}"
                                 height="40" width="40">
                        </div>
                        <h1 th:text="${comment.appUser.fullName}"></h1>
                        <h2 th:text="'@'+${comment.appUser.username}"></h2>
                    </header>
                    <blockquote th:text="${comment.content}" th:id="'comment-content'+${comment.id}">
                    </blockquote>
                    <hr>
                    <footer>
                        <p class="date-posted">Posted
                            <time th:text="${comment.timeComment}"></time>
                        </p>
                        <button class="heart"
                                th:onclick="'loveComment(\'' + ${comment.id} +'\',\''+${user.id} + '\');'">
                            <th:block th:if="${#lists.contains(listHeartUserIds, user.id)}">
                                <img src="/data/heart-active.svg" th:id="'heart-image-'+${comment.id}" height="15"
                                     width="16">
                            </th:block>
                            <th:block th:unless="${#lists.contains(listHeartUserIds, user.id)}">
                                <img src="/data/heart.svg" th:id="'heart-image-'+${comment.id}" height="15" width="16">
                            </th:block>
                            <span
                                    class="heart" th:id="'heart' + ${comment.id}" title="heart"
                                    th:text="  ${comment.loveCount}"></span>
                        </button>
                    </footer>
                </article>
            </th:block>
        </div>
        <div class="col-sm-2"></div>
    </div>
</div>
<div th:replace="~{layout/layout::footer}"></div>
</body>
</html>